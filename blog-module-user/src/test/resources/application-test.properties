# ===================================================================
# 整合測試設定檔
#
# 注意：blog-common 與 blog-infrastructure 各有一個 GlobalExceptionHandler，
#       bean name 相同但類別不相容。測試環境允許後定義覆蓋前定義以避免啟動失敗。
#       （正式環境應修正此衝突，追蹤 issue 在 plan.md）
#
# 說明：關閉與測試無關的 Auto-Configuration（Elasticsearch、RabbitMQ、MinIO），
#       避免 Spring Context 啟動時嘗試連線並導致測試失敗。
#       DataSource 與 Redis 連線由 Testcontainers @DynamicPropertySource 動態覆蓋。
# ===================================================================

# Bean 覆蓋（解決 blog-common 與 blog-infrastructure 雙重 GlobalExceptionHandler 衝突）
spring.main.allow-bean-definition-overriding=true

# 關閉不需要的 Auto-Configuration
spring.autoconfigure.exclude=\
  org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\
  org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\
  org.springframework.boot.autoconfigure.elasticsearch.ElasticsearchClientAutoConfiguration,\
  org.springframework.boot.autoconfigure.elasticsearch.ElasticsearchRestClientAutoConfiguration,\
  org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRepositoriesAutoConfiguration

# Flyway：允許在空白資料庫上執行 migration（Testcontainers 每次啟動全新容器）
spring.flyway.baseline-on-migrate=true
spring.flyway.enabled=true

# Flyway migration 腳本位置（指向 blog-start 模組的 schema）
spring.flyway.locations=classpath:db/migration

# MyBatis 設定
mybatis.configuration.map-underscore-to-camel-case=true
mybatis.configuration.use-generated-keys=true
mybatis.type-aliases-package=dowob.xyz.blog.module

# MinIO（測試中不需要，提供假設定避免啟動錯誤）
minio.endpoint=http://localhost:9000
minio.access-key=minioadmin
minio.secret-key=minioadmin
minio.bucket-name=test-bucket
